#!/bin/bash
start_dir=$(pwd)
cd $(dirname $0)
pd=$(pwd)
root_dir=$pd
toc_file=$root_dir/_data/toc.yml
docs_dir=$root_dir/_docs
echo "# ---------------------------------------------"   > $toc_file
echo "# This file is autogenerated. So don't edit it."   >> $toc_file
echo "# Refer to .gen-toc script in the root directory." >> $toc_file
echo "# ---------------------------------------------"   >> $toc_file
echo "- title: Documentation" >> $toc_file
echo "  url: docs" >> $toc_file
echo "  links:" >> $toc_file
echo "    - title: "About"" >> $toc_file
echo "      url: "index"" >> $toc_file

cd $root_dir/_docs
if [ -z "$(ls -A)" ]; then
  echo "    - title: Privacy Policy" >> $toc_file
  echo "      url: privacy" >> $toc_file
  exit 0
fi
for i in $(ls -d *) 
do
  cat_title=$(grep "title:" $i/index.md | awk -F: '{print $2}')
  echo "    - title: $cat_title" >> $toc_file
  echo "      url: docs/$i/index" >> $toc_file
  echo "      children:" >> $toc_file
  for j in $(ls $i\/*)
  do
    filename=$(basename -s .md $j)
    if [[ "$filename.md" != "index.md" ]]
    then
      doc_title=$(grep "title:" $j | awk -F: '{print $2}')
      doc_title=$(echo $doc_title)
      echo "      - title: \"$doc_title\"" >> $toc_file
      echo "        url: docs/$i/$filename" >> $toc_file
    fi
  done
done
echo "    - title: Privacy Policy" >> $toc_file
echo "      url: privacy" >> $toc_file
cd $start_dir
